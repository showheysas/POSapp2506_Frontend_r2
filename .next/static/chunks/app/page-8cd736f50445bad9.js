(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7410:function(e,t,s){Promise.resolve().then(s.bind(s,3562))},3562:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var r=s(7437),l=s(2265),a=s(6324);function n(e){let{code:t,setCode:s}=e,n=(0,l.useRef)(null),c=(0,l.useRef)(null),[d,o]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!n.current)return;let e=new a.Z(n.current,t=>{/^\d{8,13}$/.test(t.data)&&(s(t.data),e.stop(),o(!1))},{highlightScanRegion:!0,returnDetailedScanResult:!0});return c.current=e,e.start().then(()=>o(!0)),()=>{e.stop(),o(!1)}},[]),(0,r.jsxs)("div",{className:"w-full space-y-2",children:[(0,r.jsx)("label",{htmlFor:"code",className:"block text-sm font-medium text-gray-700",children:"バーコード（JANコード）を入力またはスキャン"}),(0,r.jsx)("input",{type:"text",id:"code",value:t,onChange:e=>s(e.target.value),placeholder:"例：4901777018686",className:"w-full border rounded px-3 py-2"}),(0,r.jsxs)("div",{className:"relative w-full max-w-sm aspect-video border rounded overflow-hidden",children:[(0,r.jsx)("video",{ref:n,className:"w-full h-full object-cover"}),!d&&(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-800 bg-opacity-60 flex items-center justify-center text-white",children:"カメラを起動中…"})]})]})}function c(e){let{product:t}=e;return t?(0,r.jsxs)("div",{className:"w-full space-y-2 border p-3 rounded bg-gray-50",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"商品コード："}),(0,r.jsx)("span",{className:"ml-1 font-mono",children:t.code})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"商品名："}),(0,r.jsx)("span",{className:"ml-1 font-semibold",children:t.name})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"価格："}),(0,r.jsxs)("span",{className:"ml-1",children:[t.price,"円"]})]})]}):null}let d=s(3464).Z.create({baseURL:"http://127.0.0.1:8000"});function o(e){let{code:t,setCode:s,product:l,setProduct:a,cart:n,setCart:c}=e,o=async()=>{if(!t.trim()){alert("商品コードを入力してください");return}try{let e=(await d.get("/items/".concat(Number(t)))).data;console.log("レスポンスデータ:",e);let s={code:e.CODE,name:e.NAME,price:e.PRICE};if(s&&s.name){if(a(s),n.find(e=>e.code===s.code)){let e=n.map(e=>e.code===s.code?{...e,quantity:e.quantity+1}:e);c(e)}else c([...n,{...s,quantity:1}])}else alert("商品が見つかりませんでした"),a(null)}catch(e){console.error(e),alert("商品取得時にエラーが発生しました")}s("")};return(0,r.jsx)("button",{onClick:o,className:"w-full bg-blue-200 border border-blue-500 text-blue-800 font-bold py-2 px-4 rounded",children:"スキャン（カートに追加）"})}function i(e){let{cart:t}=e,s=t.reduce((e,t)=>e+t.price*t.quantity,0);return(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-2",children:"購入リスト"}),(0,r.jsxs)("table",{className:"w-full border border-gray-300",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-200",children:[(0,r.jsx)("th",{className:"py-1 px-2 border",children:"商品名"}),(0,r.jsx)("th",{className:"py-1 px-2 border",children:"単価"}),(0,r.jsx)("th",{className:"py-1 px-2 border",children:"数量"}),(0,r.jsx)("th",{className:"py-1 px-2 border",children:"小計"})]})}),(0,r.jsx)("tbody",{children:t.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"py-1 px-2 border",children:e.name}),(0,r.jsxs)("td",{className:"py-1 px-2 border",children:[e.price,"円"]}),(0,r.jsx)("td",{className:"py-1 px-2 border",children:e.quantity}),(0,r.jsxs)("td",{className:"py-1 px-2 border",children:[e.price*e.quantity,"円"]})]},e.code))}),(0,r.jsx)("tfoot",{children:(0,r.jsxs)("tr",{className:"font-bold bg-gray-100",children:[(0,r.jsx)("td",{colSpan:3,className:"py-1 px-2 border text-right",children:"合計"}),(0,r.jsxs)("td",{className:"py-1 px-2 border",children:[s,"円"]})]})})]})]})}function x(e){let{cart:t,setCart:s}=e,[a,n]=(0,l.useState)(!1),[c,o]=(0,l.useState)(0),[i,x]=(0,l.useState)(0),u=async()=>{if(0===t.length){alert("カートが空です");return}let e={emp_cd:"9999999999",store_cd:"00030",pos_no:"090",details:t.map(e=>({prd_code:String(e.code),prd_name:e.name,prd_price:e.price,tax_cd:"01"}))};try{let{total_amount:t,total_amount_ex_tax:r}=(await d.post("/purchase",e)).data;o(t),x(r),n(!0),s([])}catch(e){if("object"==typeof e&&null!==e&&"isAxiosError"in e&&!0===e.isAxiosError){var r,l;let t="不明なエラーが発生しました";if("string"==typeof(null===(r=e.response)||void 0===r?void 0:r.data))t=e.response.data;else if("object"==typeof(null===(l=e.response)||void 0===l?void 0:l.data)&&null!==e.response.data){let s=e.response.data;"detail"in s?t="string"==typeof s.detail?s.detail:JSON.stringify(s.detail):"message"in s&&(t=s.message)}console.error("購入処理エラー (Axios):",t,e)}else e instanceof Error?console.error("購入処理エラー (Generic Error):",e.message):console.error("購入処理エラー (Unknown Error):",e);alert("購入処理に失敗しました")}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:u,className:"mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded",children:"購入確定"}),a&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.4)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 w-11/12 max-w-sm text-center",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"購入が完了しました"}),(0,r.jsxs)("p",{className:"text-sm",children:["合計（税込）：",(0,r.jsxs)("span",{className:"font-bold",children:[c.toLocaleString(),"円"]})]}),(0,r.jsxs)("p",{className:"text-sm mb-6",children:["税抜金額：",(0,r.jsxs)("span",{className:"font-bold",children:[i.toLocaleString(),"円"]})]}),(0,r.jsx)("button",{onClick:()=>n(!1),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition",children:"OK"})]})})]})}function u(){let[e,t]=(0,l.useState)(""),[s,a]=(0,l.useState)(null),[d,u]=(0,l.useState)([]);return(0,r.jsxs)("main",{className:"flex flex-col items-center p-4 space-y-4 max-w-md mx-auto",children:[(0,r.jsx)("h1",{className:"text-xl font-bold mb-2",children:"モバイルPOSアプリ"}),(0,r.jsx)(n,{code:e,setCode:t}),(0,r.jsx)(c,{product:s}),(0,r.jsx)(o,{code:e,setCode:t,product:s,setProduct:a,cart:d,setCart:u}),(0,r.jsx)(i,{cart:d}),(0,r.jsx)(x,{cart:d,setCart:u})]})}console.log("API BASE URL:","http://127.0.0.1:8000")}},function(e){e.O(0,[710,971,117,744],function(){return e(e.s=7410)}),_N_E=e.O()}]);